{% extends 'Maintenance/main.html' %}
{% block content %}
  <div class="row">
    <div class="col-md">
      <div class="form-container">
        <form action="" method="post">
          {% csrf_token %}
          <h2>Manage PC</h2>
          <div class="form-grid">
            <div class="form-column">
              <div class="form-field">{{ pcform.customer.label_tag }}
                {{ pcform.customer }}</div>

              <div class="form-field">{{ pcform.device_type_model.label_tag }}
                {{ pcform.device_type_model }}</div>

              <div class="form-field">{{ pcform.issue.label_tag }}
                {{ pcform.issue }}</div>

              <div class="form-field">{{ pcform.serial_number.label_tag }}
                {{ pcform.serial_number }}</div>
              <div class="form-field">{{ pcform.motherboard.label_tag }}
                {{ pcform.motherboard }}</div>
              <div class="form-field">{{ pcform.processor.label_tag }}
                {{ pcform.processor }}</div>
            </div>
            <div class="form-column">
              <div class="form-column">
                <label>How many RAMs?</label>
                <select id="ram-count">
                  <option value="0">0</option>
                  {% for i in '1234'|make_list %}
                    <option value="{{ i }}">{{ i }}</option>
                  {% endfor %}
                </select>

                <div class="form-field">
                  {{ ram_formset.management_form }}
                  {% for form in ram_formset %}
                    <div class="ram-form" style="display: none;">{{ form.as_p }}</div>
                  {% endfor %}
                </div>

                <label>How many hards?</label>
                <select id="hard-count">
                  <option value="0">0</option>
                  {% for i in '1234'|make_list %}
                    <option value="{{ i }}">{{ i }}</option>
                  {% endfor %}
                </select>

                <div class="form-field">
                  {{ hard_formset.management_form }}
                  {% for form in hard_formset %}
                    <div class="hard-form" style="display: none;">{{ form.as_p }}</div>
                  {% endfor %}
                </div>
              </div>
            </div>
            <div class="form-column">
              <div class="form-field">{{ pcform.secondary_hard_drive.label_tag }}
                {{ pcform.secondary_hard_drive }}</div>

              <div class="form-field">{{ pcform.igc.label_tag }}
                {{ pcform.igc }}</div>

              <div class="form-field">{{ pcform.dsgc.label_tag }}
                {{ pcform.dsgc }}</div>

              <div class="form-field">{{ pcform.drive.label_tag }}
                {{ pcform.drive }}</div>

              <div class="form-field">{{ pcform.powersupply.label_tag }}
                {{ pcform.powersupply }}</div>

              <div class="form-field">{{ pcform.case_type.label_tag }}
                {{ pcform.case_type }}</div>

              <div class="form-field">{{ pcform.cooling_system.label_tag }}
                {{ pcform.cooling_system }}</div>

              <div class="form-field">{{ pcform.expansion_slots.label_tag }}
                {{ pcform.expansion_slots }}</div>

              <div class="form-field">{{ pcform.notes.label_tag }}
                {{ pcform.notes }}</div>
            </div>
          </div>
          <input type="submit" name="submit" value="submit" class="submit-button" />
        </form>
      </div>
    </div>
  </div>
  <script>
    function toggleForms(prefix, count) {
      const forms = document.querySelectorAll('.' + prefix + '-form')
      forms.forEach((div, index) => {
        div.style.display = index < count ? 'block' : 'none'
      })
    }
    
    function initFormCount(prefix) {
      const forms = document.querySelectorAll('.' + prefix + '-form')
      const countSelect = document.getElementById(prefix + '-count')
    
      const existingCount = Array.from(forms).filter((f) => {
        // 🔍 بدنا نتحقق إذا الفورم فيه مدخلات بيانات
        return f.querySelectorAll('input, select, textarea').some((input) => input.value.trim() !== '')
      }).length
    
      // ✅ إذا ما في بيانات، نخلي القيمة صفر
      const finalCount = existingCount > 0 ? existingCount : 0
      countSelect.value = finalCount
      toggleForms(prefix, finalCount)
    }
    
    // ⚙️ عند تغيير القيمة من المستخدم
    document.getElementById('ram-count').addEventListener('change', function () {
      toggleForms('ram', parseInt(this.value))
    })
    
    document.getElementById('hard-count').addEventListener('change', function () {
      toggleForms('hard', parseInt(this.value))
    })
    
    // 🚀 عند تحميل الصفحة: نحدد إذا كانت تعديل أو إضافة ونعرض بناءً عليه
    window.onload = function () {
      initFormCount('ram')
      initFormCount('hard')
    }
  </script>
{% endblock %}
